# CSRF

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

La vulnerabilidad Cross Site Request Forgery (CSRF) ocurre cuando un usuario visita una página en un sitio, que realiza una acción en un sitio diferente. Por ejemplo, digamos que un usuario hace clic en un enlace a un sitio web creado por un atacante, en el sitio web habría una etiqueta html como:

`<img src="https://vulnerable-website.com/email/change?email=pwn@evil-user.net ">`&#x20;

que cambiaría el correo electrónico de la cuenta en el sitio web vulnerable a `pwn@evil-user.net`.&#x20;

CSRF funciona porque es la víctima quien realiza la solicitud, no el sitio, por lo que todo lo que ve el sitio es un usuario normal que realiza una solicitud normal.

Esto abre la puerta a que la cuenta del usuario se vea comprometida por completo mediante el uso de un password reset, por ejemplo. No se puede exagerar la gravedad de esto, ya que permite que un atacante obtenga potencialmente información personal sobre un usuario, como los detalles de la tarjeta de crédito.

## Explotación automática

Si queremos automatizar nuestra búsqueda existe un buen escáner, que prueba si un sitio es vulnerable a CSRF.&#x20;

Esta herramienta se conoce como `xsrfprobe` y se puede instalar a través de pip:

```bash
pip3 install xsrfprobe
```

La sintaxis del comando es `xsrfprobe -u <url>/<endpoint>`

## Cómo prevenir ataques CSRF

La forma más sólida de defenderse de los ataques CSRF es incluir un token CSRF en las solicitudes pertinentes. El token debe ser

* Impredecible con alta entropía, como para los tokens de sesión en general.
* Vinculado a la sesión del usuario.
* Se valida estrictamente en todos los casos antes de ejecutar la acción correspondiente.



