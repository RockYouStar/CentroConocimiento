# Path Hijacking

El Path Hijacking es una técnica de escalada de privilegios, que si se combinan con, por ejemplo, el privilegio SUID o sudo, puede llegar a ser peligrosa.

## Conceptos importantes

La ruta absoluta es la ruta completa que comienza con el directorio raíz (/) y llega hasta el archivo o el directorio solicitado. Para conocer la ruta absoluta de un archivo o directorio, ejecute rápidamente el comando pwd, y se le mostrará la ruta completa.

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Las rutas absolutas no cambian cuando cambia el directorio actual. Piensa en ellas como rutas codificadas, mientras que las rutas relativas son rutas dinámicas que cambian dependiendo de la ubicación actual del directorio de trabajo.

La idea que hay detrás del Path Hijacking es abusar del path para poder controlar el binario que se ejecuta al llamar a un binario con su ruta relativa.

Veámoslo mejor con un ejemplo:

```c
#include <stdio.h>

int main(){

    setuid(0);
    printf("[*] Mostrando el contenido del directorio actual usando /usr/bin/ls\n");
    system("/usr/bin/ls");

    printf("[*] Mostrando el contenido del directorio actual usando ls\n");
    system("ls");

    return 0;
}

```

Si lo ejecutamos sin modificar el path, obtenemos la siguiente salida:

<figure><img src="../../../.gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

Ahora vamos a modificar el path poniendo como primera ruta un directorio donde tenemos capacidad de escritura y ahí vamos a crear un binario que se llame ls que va a ser el que se ejecute cuando se haga la llamada a `system("ls");`

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

Ahora, creamos en /tmp/test un binario llamado ls:

```c
#include <stdio.h>

int main(){

    system("/bin/bash -p");

    return 0;
}
```

De esta forma, al haber modificado el PATH, se ejecutará primero nuestro binario controlado y obtendremos una instancia de /bin/bash:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

