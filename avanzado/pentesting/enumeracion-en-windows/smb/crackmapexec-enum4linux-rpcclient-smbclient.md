# Crackmapexec, enum4linux, rpcclient, smbclient

Si queremos obtener información interesante sobre el entorno SMB podemos hacer uso de las siguiente herramientas:

```bash
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>
nmap --script "safe or smb-enum-*" -p 445 <IP>
```

Si queremos conectarnos a RPC:

```bash
rpcclient -U "" -N <IP>
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
```

Para obtener información sobre los usuarios:

```bash
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]<targetName or address>
crackmapexec smb IP --groups [-u <username> -p <password>]
crackmapexec smb IP --groups --loggedon-users [-u <username> -p <password>]
ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "
rpcclient -U "" -N IP
enumdomusers
enumdomgroups
```

También podemos enumerar usuarios locales con:

```bash
lookupsid.py -no-pass hostname.local
```

### Numerar directorios compartidos:

Siempre es recomendable mirar si puedes acceder a algo, si no tienes credenciales prueba a usar credenciales nulas/usuario invitado.

```bash
smbclient --no-pass -L //<IP>
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP>
smbmap -u "username" -p "password" -H <IP> [-P <PORT>]
smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] 
smbmap -R -u "username" -p "password" -H <IP> [-P <PORT>]

crackmapexec smb <IP> -u '' -p '' --shares
crackmapexec smb <IP> -u 'username' -p 'password' --shares 
crackmapexec smb <IP> -u 'username' -H '<HASH>' --shares 
```

### Conectarse a directorios compartidos:

<pre class="language-bash"><code class="lang-bash"><strong>smbclient --no-pass //&#x3C;IP>/&#x3C;Folder>
</strong>smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //&#x3C;IP>
smbmap [-u "username" -p "password"] -R [Folder] -H &#x3C;IP> [-P &#x3C;PORT>]
smbmap [-u "username" -p "password"] -r [Folder] -H &#x3C;IP> [-P &#x3C;PORT>]
smbmap -u "username" -p "&#x3C;NT>:&#x3C;LM>" [-r/-R] [Folder] -H &#x3C;IP> [-P &#x3C;PORT>]</code></pre>

