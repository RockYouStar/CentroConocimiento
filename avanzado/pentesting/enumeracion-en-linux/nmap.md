# Nmap

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

Nmap (Network Mapper) es una de las herramientas más utilizadas para descubrir hosts y servicios en una red enviando paquetes y analizando las respuestas. Es un escáner de red de código abierto creado por Gordon Lyon.

Nmap permite detectar ordenadores, servicios y sistemas operativos. Mediante el uso de scripts, esta herramienta proporciona servicios avanzados de detección de vulnerabilidades y de otras aplicaciones. Es capaz de adaptarse a las condiciones de la red modificando la latencia y la agresividad del escaneo para evitar congestionar la red. Nmap también tiene una interfaz gráfica llamada [zenmap](https://nmap.org/zenmap/).

### Instalación en sistemas Windows 10

Para descargar Nmap para Windows, tenemos que ir a la página oficial de descargas y bajar la última versión estable.

El instalador .exe que se comenzará a descargar contiene principalmente: nmap, npcap (necesarios para el funcionamiento de todo el software).

### Instalación en sistemas GNU/Linux

\
Para instalar Nmap en Debian o Ubuntu puedes utilizar los repositorios oficiales. Es tan sencillo como abrir nuestro terminal y escribir

```bash
$ sudo apt-get install nmap 
```

En algunas distros, como Kali Linux, viene preinstalado.

### Ejemplos prácticos de Nmap

**\<Dirección IP / nombre de host>:** Escanear con opciones por defecto

```bash
$ sudo nmap 192.168.1.1
...
$ sudo nmap www.google.es
```

**\<Rango de direcciones IP>:** En el ejemplo escanearemos todas las IPs desde la 192.168.1.1 hasta la 192.168.1.50.

```bash
$ sudo nmap 192.168.1.1-50
```

**\<Subred IP>:**  En este caso estamos escaneando desde la IP 192.168.1.1 hasta la 192.168.1.254

```bash
$ sudo nmap 192.168.1.1/24
```

**-iL \<nombre de archivo>:** Escanear objetivos desde un archivo de texto. Esta opción es recomendable si vamos a escanear un numero de elevado o no consecutivo de IPs. Por ejemplo, si queremos escanear todas las IPs de España que tengamos en un fichero.

```bash
$ sudo nmap -iL ipsobjetivos.txt
```

**-p \<puerto, rango de puertos>:** Escaneamos el puerto 80, o los puertos 22 y 80, o los puertos del 1 al 1024 (puertos de servidor).

```bash
$ sudo nmap 192.168.1.1 -p 80
...
$ sudo nmap 192.168.1.1 -p 22,80
...
$ sudo nmap 192.168.1.1 -p 1-1024
```

**-oN \<fichero>:** Almacenar los resultados en un archivo TXT.

```bash
$ sudo nmap -oN resultado.txt 192.168.1.1
```

**-oX \<fichero>:** Si queremos almacenar los resultados en un archivo XML.

```bash
$ sudo nmap -oX resultado.xml 192.168.1.1
```

**-oA \<fichero>:** Almacenar los resultados en todos los formatos.

```bash
$ sudo nmap -oA resultado192.168.1.1
```

**-sS:** Escaneo TCP SYN.

```bash
$ sudo nmap -sS 192.168.1.1
```

**-sT:** Escaneo TCP Connect().

```bash
$ sudo nmap -sT 192.168.1.1
```

**-sA:** Escaneo TCP ACK.

```bash
$ sudo nmap -sA 192.168.1.1
```

**-sn:** Escaneo Ping. No hace escaneo de puertos.

```bash
$ sudo nmap -sn 192.168.1.1
```

**-sU:** Escaneo UDP.

```bash
$ sudo nmap -sU 192.168.1.1
```

**-sV:** Detectar versión de servicios. Nos proporcionará un listado de los puertos abiertos e información adicional sobre los servicios que se están ejecutando.

```bash
$ sudo nmap -sV scanme.nmap.org
...
PORT      STATE    SERVICE      VERSION
22/tcp    open     ssh          OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.11 (Ubuntu Linux; protocol 2.0)
80/tcp    open     http         Apache httpd 2.4.7 ((Ubuntu))
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
9929/tcp  open     nping-echo   Nping echo
31337/tcp open     tcpwrapped
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
...
```

En el puerto 22/tcp hay un servicio SSH, concretamente con la versión 6.6.1p1 de OpenSSH. También podemos ver que en el puerto 80/tcp tenemos un servidor Apache versión 2.4.7. Ambos servicios se están ejecutando bajo Ubuntu.

Esta información puede ser muy útil para potenciales atacantes ya que, puede haber alguna vulnerabilidad en estos servicios. Podría ser explotada y comprometer el servidor.

<figure><img src="../../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

**-O:** Detección de sistemas operativos. Nos dirá que tipo de sistema operativo corre en el host al que estamos escaneando.

```bash
$ sudo nmap -O 192.168.1.1
...
Device type: general purpose|storage-misc|firewall
Running (JUST GUESSING): Linux 4.X|3.X|2.6.X (96%), Synology DiskStation Manager 5.X (87%), WatchGuard Fireware 11.X (87%)
OS CPE: cpe:/o:linux:linux_kernel:4.4 cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:linux:linux_kernel cpe:/a:synology:diskstation_manager:5.1 cpe:/o:watchguard:fireware:11.8
Aggressive OS guesses: Linux 4.4 (96%), Linux 4.0 (93%), Linux 3.11 - 4.1 (92%), Linux 2.6.32 (92%), Linux 3.10 - 3.12 (92%), Linux 2.6.32 or 3.10 (91%), Linux 2.6.32 - 2.6.35 (90%), Linux 3.13 (90%), Linux 2.6.32 - 2.6.39 (90%), Linux 3.10 - 4.2 (89%)
No exact OS matches for host (test conditions non-ideal).
...
```

**-A:** Información de sitemas operativos, escaneo con scripts, detección de servicios, traceroute. Esta opción nos dará mucha información utilizando un único parámetro. Combina las opciones -sV y -O mencionadas antes.

```bash
$ sudo sudo nmap -A 192.168.1.1s
```

**-Pn:** Hacer escaneo sin hacer host discovery, por lo tanto, ignora la respuesta a Ping. De lo contrario, si el host no responde a Ping, nmap no realiza el escaneo. Muy útil cuando el host está levantado pero bloquea los Ping.

```bash
$ sudo nmap -Pn 192.168.1.1
```

**-F:** Modo rápido: Escanea menos puertos, por lo que es menos ruidoso y rápido

```bash
$ sudo nmap -F 192.168.1.1
```

**-n:** Evitar que haga resolución DNS. No resuelve nombres ni direcciones IP por lo que es más rápido.

**-D:** Mandar peticiones desde todas las IPs que deseemos (IP spoofing), además de la nuestra, claro. Así el host no sabe exactamente desde cual se hace el escaneo. nmap -D y una lista de direcciones IP (no pongáis 8.8.8.8 ni 4.4.4.4). Poned direcciones creíbles, por ejemplo IPs de otros países.

**-g:** Cambiar el puerto de origen. Esta opción nos sirve para cambiar el puerto de origen y en ocasiones permite evadir a algunos firewalls que bloquean los puertos del cliente. Recomendable usar los puertos 53 (DNS) y 123 (NTP) ya que son puertos que a veces no bloquean los administradores.

```bash
$ sudo nmap -g 53 192.168.1.1
```

**--open:** Mostrar únicamente los puertos abiertos. Esta opción es muy útil para que nmap solo indique los puertos que están abiertos y no la ristra de puertos cerrados.

```bash
$ sudo nmap --open 192.168.1.1
```

**-oG:** Guardar el resultado en un formato que permita procesarlo con grep.

```bash
$ sudo nmap 192.168.1.1 -oG destino.txt
```

**-vv:** Modo «super» verboso. Nos permite ver que hace nmap a medida que el escaneo se ejecuta.

```bash
$ sudo nmap -vv 192.168.1.1
```

<figure><img src="../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

Y con todas estas opciones que ofrece nmap te invito a que las pongas en práctica y juegues un poco con ellas. Puedes utilizar [el sitio web de nmap](http://scanme.nmap.org/) que nos da permiso para escanearlo.
